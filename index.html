// APLICAR RENDERER GRADUADO (com 70% transparência -> alpha = 0.3)
bairrosLayer.renderer = {
  type: "simple",
  symbol: {
    type: "simple-fill",
    outline: { color: "#777", width: 0.5 }
  },
  visualVariables: [
    {
      type: "color",
      valueExpression: `
        var pg = ${JSON.stringify(progresso)};
        var v = pg[$feature.cod_bairro];
        return DefaultValue(v, 0);
      `,
      stops: [
        { value: -20, color: "rgba(192,0,0,0.3)", label: "Abaixo de -20%" },
        { value: -10, color: "rgba(255,63,63,0.3)", label: "-20% a -10%" },
        { value: 0,   color: "rgba(244,146,75,0.3)", label: "-10% a 0%" },
        { value: 10,  color: "rgba(127,255,255,0.3)", label: "0% a 10%" },
        { value: 20,  color: "rgba(0,192,192,0.3)", label: "10% a 20%" },
        { value: 100, color: "rgba(0,128,128,0.3)", label: "Acima de 20%" }
      ]
    }
  ]
};

// garantir que a camada não tenha opacidade global menor
bairrosLayer.opacity = 1;

// forçar refresh do layer e aguardar layerView para garantir que a tela atualize
bairrosLayer.refresh();
view.whenLayerView(bairrosLayer).then(function(layerView) {
  // opcional: forçar uma atualização visual do layerView
  if (layerView && layerView.update) {
    try { layerView.update(); } catch(e) { /* alguns layerViews não implementam update */ }
  }
});
