<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  font-family:Arial,Helvetica,sans-serif;
  overflow:hidden;
}
#container{
  height:100%;
  display:flex;
  flex-direction:column;
}
.titleBar{
  background:#6FAFB3;
  color:#fff;
  text-align:center;
  padding:6px;
  font-weight:600;
}
.wrap{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
}
.topRow{
  display:flex;
  gap:16px;
  align-items:center;
}
.chartBox{
  width:220px;
  height:220px;
}
svg{
  width:100%;
  height:100%;
  overflow:visible;
}
.legend{
  display:flex;
  gap:14px;
  font-size:11px;
}
.legItem{
  display:flex;
  gap:6px;
  align-items:center;
}
.swatch{
  width:12px;
  height:12px;
  border-radius:3px;
}
.tableBox{
  border:1px solid #d1d5db;
  border-radius:6px;
  overflow:hidden;
}
table{
  border-collapse:collapse;
  font-size:11px;
}
th,td{
  padding:6px 8px;
  border-bottom:1px solid #e5e7eb;
}
th{ background:#f9fafb; text-align:left; }
td:last-child, th:last-child{ text-align:right; }

.pctLabel{
  font-size:6px;
  fill:#111;
  font-weight:600;
  paint-order:stroke fill;
  stroke:#fff;
  stroke-width:2px;
}

.leaderLine{
  stroke:#6b7280;
  stroke-width:0.6;
}
</style>
</head>

<body>
<div id="container">
  <div class="titleBar">Canais 1P</div>

  <div class="wrap">
    <div class="topRow">
      <div class="chartBox">
        <svg id="donut" viewBox="0 0 100 100"></svg>
      </div>

      <div class="tableBox">
        <table>
          <thead>
            <tr><th>Canal</th><th>Prog %</th></tr>
          </thead>
          <tbody id="progBody"></tbody>
        </table>
      </div>
    </div>

    <div class="legend" id="legend"></div>
  </div>
</div>

<script>
const data = [
  { label:"E-commerce", atual:65146146.23, ant:72279516.41, color:"#1F5A78" },
  { label:"Loja Física", atual:858291478.47, ant:844164025.08, color:"#0B2E3F" },
  { label:"Televendas", atual:10464634.10, ant:11265095.23, color:"#F28C38" }
];

// ===== DONUT =====
const svg = document.getElementById("donut");
const cx=50, cy=50, rO=46, rI=28;
const ROTATION = 0; // <<< rotação do gráfico (0 = começa à direita)

// fundo
const bg = document.createElementNS("http://www.w3.org/2000/svg","circle");
bg.setAttribute("cx",cx);
bg.setAttribute("cy",cy);
bg.setAttribute("r",(rO+rI)/2);
bg.setAttribute("fill","none");
bg.setAttribute("stroke","#e5e7eb");
bg.setAttribute("stroke-width",rO-rI);
svg.appendChild(bg);

const total = data.reduce((s,d)=>s+d.atual,0);
let angle = ROTATION;

data.forEach(d=>{
  const pct = d.atual / total;
  const delta = pct * 360;
  const start = angle;
  const end = angle + delta;

  const a0=(start)*Math.PI/180;
  const a1=(end)*Math.PI/180;

  const path = document.createElementNS("http://www.w3.org/2000/svg","path");
  path.setAttribute("fill", d.color);
  path.setAttribute("d",`
    M ${cx+rO*Math.cos(a1)} ${cy+rO*Math.sin(a1)}
    A ${rO} ${rO} 0 ${delta>180?1:0} 1 ${cx+rO*Math.cos(a0)} ${cy+rO*Math.sin(a0)}
    L ${cx+rI*Math.cos(a0)} ${cy+rI*Math.sin(a0)}
    A ${rI} ${rI} 0 ${delta>180?1:0} 0 ${cx+rI*Math.cos(a1)} ${cy+rI*Math.sin(a1)}
    Z
  `);
  svg.appendChild(path);

  // ===== LINHA + TEXTO =====
  const mid = start + delta/2;
  const aMid = mid * Math.PI/180;

  const x1 = cx + rO * Math.cos(aMid);
  const y1 = cy + rO * Math.sin(aMid);

  const x2 = cx + (rO + 10) * Math.cos(aMid);
  const y2 = cy + (rO + 10) * Math.sin(aMid);

  const line = document.createElementNS("http://www.w3.org/2000/svg","line");
  line.setAttribute("x1",x1);
  line.setAttribute("y1",y1);
  line.setAttribute("x2",x2);
  line.setAttribute("y2",y2);
  line.setAttribute("class","leaderLine");
  svg.appendChild(line);

  const txt = document.createElementNS("http://www.w3.org/2000/svg","text");
  txt.setAttribute("x", cx + (rO + 14) * Math.cos(aMid));
  txt.setAttribute("y", cy + (rO + 14) * Math.sin(aMid));
  txt.setAttribute("class","pctLabel");
  txt.setAttribute("text-anchor", Math.cos(aMid) > 0 ? "start" : "end");
  txt.textContent = (pct*100).toFixed(1).replace(".",",") + "%";
  svg.appendChild(txt);

  angle += delta;
});

// ===== LEGENDA =====
const legend = document.getElementById("legend");
data.forEach(d=>{
  legend.innerHTML += `
    <div class="legItem">
      <span class="swatch" style="background:${d.color}"></span>
      <span>${d.label}</span>
    </div>`;
});

// ===== TABELA =====
const tb = document.getElementById("progBody");
data.forEach(d=>{
  const prog = ((d.atual - d.ant) / d.ant) * 100;
  tb.innerHTML += `
    <tr>
      <td>${d.label}</td>
      <td>${prog.toFixed(2).replace(".",",")}%</td>
    </tr>`;
});
</script>
</body>
</html>
