<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>

<style>
:root{
  --bg:#ffffff;
  --text:#111827;
  --pad:10px;
}
html, body{
  margin:0;
  padding:0;
  height:100%;
  width:100%;
  background:var(--bg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  overflow:hidden;
}
*{ box-sizing:border-box; }

.titleBar{
  width:100%;
  background:#6FAFB3;
  color:#fff;
  text-align:center;
  font-weight:600;
  font-size:14px;
  padding:6px 0;
}

#container{
  height:100%;
  width:100%;
  padding:var(--pad);
  display:flex;
  flex-direction:column;
  gap:8px;
}

.wrap{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
}

.topRow{
  width:100%;
  display:flex;
  justify-content:center;
  gap:16px;
}

.chartBox{
  width:260px;
  aspect-ratio:1;
}

svg{ width:100%; height:100%; }

.legend{
  display:flex;
  gap:16px;
  flex-wrap:wrap;
  justify-content:center;
}

.legItem{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:11px;
}

.swatch{
  width:12px;
  height:12px;
  border-radius:3px;
}

.tableBox{
  width:220px;
  border:1px solid #d1d5db;
  border-radius:6px;
  overflow:hidden;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:11px;
}

th, td{
  padding:6px 8px;
  border-bottom:1px solid #e5e7eb;
}

th{
  background:#f9fafb;
  text-align:left;
}

td:last-child, th:last-child{
  text-align:right;
}
</style>
</head>

<body>
<div id="container">
  <div class="titleBar">Canais 1P</div>

  <div class="wrap">
    <div class="topRow">
      <div class="chartBox">
        <svg id="donut" viewBox="0 0 100 100"></svg>
      </div>

      <div class="tableBox">
        <table>
          <thead>
            <tr>
              <th>Canal</th>
              <th>Prog %</th>
            </tr>
          </thead>
          <tbody id="progBody"></tbody>
        </table>
      </div>
    </div>

    <div class="legend" id="legend"></div>
  </div>
</div>

<script>
const data = [
  { canal:"E-commerce", atual:65146146.23, ant:72279516.41, color:"#1F5A78" },
  { canal:"Loja Física", atual:858291478.47, ant:844164025.08, color:"#0B2E3F" },
  { canal:"Televendas", atual:10464634.10, ant:11265095.23, color:"#F28C38" }
];

// ===== DONUT =====
const total = data.reduce((s,d)=>s+d.atual,0);
let angle = 0;
const svg = document.getElementById("donut");

data.forEach(d=>{
  const pct = (d.atual / total) * 100;
  const delta = pct * 3.6;
  const rO=46, rI=28, cx=50, cy=50;

  const a0=(angle-90)*Math.PI/180;
  const a1=(angle+delta-90)*Math.PI/180;

  const p = document.createElementNS("http://www.w3.org/2000/svg","path");
  p.setAttribute("fill", d.color);
  p.setAttribute("d",`
    M ${cx+rO*Math.cos(a1)} ${cy+rO*Math.sin(a1)}
    A ${rO} ${rO} 0 ${delta>180?1:0} 0 ${cx+rO*Math.cos(a0)} ${cy+rO*Math.sin(a0)}
    L ${cx+rI*Math.cos(a0)} ${cy+rI*Math.sin(a0)}
    A ${rI} ${rI} 0 ${delta>180?1:0} 1 ${cx+rI*Math.cos(a1)} ${cy+rI*Math.sin(a1)}
    Z
  `);
  svg.appendChild(p);
  angle += delta;
});

// ===== LEGENDA =====
const leg = document.getElementById("legend");
data.forEach(d=>{
  leg.innerHTML += `
    <div class="legItem">
      <span class="swatch" style="background:${d.color}"></span>
      <span>${d.canal}</span>
    </div>
  `;
});

// ===== TABELA (PROGRESSÃO CORRETA) =====
const tb = document.getElementById("progBody");

data.forEach(d=>{
  const prog = ((d.atual - d.ant) / d.ant) * 100;
  tb.innerHTML += `
    <tr>
      <td>${d.canal}</td>
      <td>${prog.toFixed(2).replace(".",",")}%</td>
    </tr>
  `;
});
</script>
</body>
</html>
