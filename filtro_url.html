<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Filtros Avan√ßados</title>

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }
body { margin: 0; padding: 16px; background: #f5f5f5; }

.card {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(0,0,0,.12);
}

h3 { margin-top: 0; }

label {
  font-weight: bold;
  font-size: 13px;
  margin-top: 14px;
  display: block;
}

select, .dropdown-btn {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.dropdown { position: relative; }

.dropdown-btn {
  background: #fff;
  cursor: pointer;
  text-align: left;
}

.dropdown-panel {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  max-height: 220px;
  overflow-y: auto;
  padding: 6px;
  z-index: 1000;
}

.dropdown-panel.open { display: block; }

.item {
  padding: 6px;
  font-size: 13px;
}

.footer {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.btn-primary {
  flex: 1;
  background: #1976d2;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 12px;
  cursor: pointer;
}

.btn-clear {
  flex: 1;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 12px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="card">
  <h3>Filtros Avan√ßados</h3>

  <label>Loja</label>
  <select id="loja">
    <option value="">-- Todas --</option>
    <option value="1">1 - Interlagos</option>
    <option value="2">2 - Morumbi</option>
  </select>

  <label>Se√ß√£o</label>
  <div class="dropdown">
    <div class="dropdown-btn" onclick="toggle('secao')">Selecionar...</div>
    <div class="dropdown-panel" id="secao">
      <label class="item"><input type="checkbox" value="A1"> A1</label>
      <label class="item"><input type="checkbox" value="A2"> A2</label>
      <label class="item"><input type="checkbox" value="B1"> B1</label>
    </div>
  </div>

  <label>Canal</label>
  <div class="dropdown">
    <div class="dropdown-btn" onclick="toggle('canal')">Selecionar...</div>
    <div class="dropdown-panel" id="canal">
      <label class="item"><input type="checkbox" value="1"> Loja F√≠sica</label>
      <label class="item"><input type="checkbox" value="2"> E-commerce</label>
    </div>
  </div>

  <label>Ano</label>
  <select id="ano">
    <option value="">-- Todos --</option>
    <option value="2024">2024</option>
    <option value="2025">2025</option>
  </select>

  <label>M√™s</label>
  <div class="dropdown">
    <div class="dropdown-btn" onclick="toggle('mes')">Selecionar...</div>
    <div class="dropdown-panel" id="mes">
      <label class="item"><input type="checkbox" value="1"> Janeiro</label>
      <label class="item"><input type="checkbox" value="2"> Fevereiro</label>
      <label class="item"><input type="checkbox" value="3"> Mar√ßo</label>
      <label class="item"><input type="checkbox" value="4"> Abril</label>
    </div>
  </div>

  <div class="footer">
    <button class="btn-primary" onclick="aplicar()">Aplicar</button>
    <button class="btn-clear" onclick="limpar()">Limpar</button>
  </div>
</div>

<script>
function toggle(id) {
  document.querySelectorAll('.dropdown-panel')
    .forEach(p => p.id !== id && p.classList.remove('open'));
  document.getElementById(id).classList.toggle('open');
}

document.addEventListener('click', e => {
  if (!e.target.closest('.dropdown'))
    document.querySelectorAll('.dropdown-panel')
      .forEach(p => p.classList.remove('open'));
});

function getValues(id) {
  return [...document.querySelectorAll(`#${id} input:checked`)]
    .map(i => i.value);
}

function aplicar() {

  const params = new URLSearchParams();

  const loja = document.getElementById('loja').value;
  const ano  = document.getElementById('ano').value;
  const secao = getValues('secao');
  const canal = getValues('canal');
  const mes   = getValues('mes');

  if (loja) params.set('loja', loja);
  if (ano)  params.set('ano', ano);
  if (secao.length) params.set('secao', secao.join(','));
  if (canal.length) params.set('canal', canal.join(','));
  if (mes.length)   params.set('mes', mes.join(','));

  const url =
    "https://51072874.github.io/Leroy/venda_percentual.html?" +
    params.toString();

  // üî• ATUALIZA O GR√ÅFICO
  window.parent.document
    .getElementById('iframe-grafico')
    .src = url;
}

function limpar() {
  document.querySelectorAll('input[type=checkbox]').forEach(c => c.checked = false);
  document.getElementById('loja').value = "";
  document.getElementById('ano').value = "";
}
</script>

</body>
</html>
