<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Mapa Leroy Merlin</title>

  <link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.30/"></script>

  <style>
    html, body, #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>
<div id="viewDiv"></div>

<script>

const LOJAS_URL   = "https://igeo.leroymerlin.com.br/server/rest/services/Hosted/One_Page_SpotX/FeatureServer/0";
const ZONAS_URL   = "https://igeo.leroymerlin.com.br/server/rest/services/Hosted/One_Page_SpotX/FeatureServer/1";
const BAIRROS_URL = "https://igeo.leroymerlin.com.br/server/rest/services/Hosted/One_Page_SpotX/FeatureServer/2";
const VENDAS_URL  = "https://igeo.leroymerlin.com.br/server/rest/services/Hosted/One_Page_SpotX/FeatureServer/8";

// ---------------- PEGAR parametros
const params = new URLSearchParams(window.location.search);

let codLoja = params.get("cod_loja");

// trata invÃ¡lido
if(!codLoja || codLoja === "" || codLoja === "null" || codLoja === "undefined")
  codLoja = "0";

require([
  "esri/Map",
  "esri/views/MapView",
  "esri/layers/FeatureLayer"
], function(Map, MapView, FeatureLayer) {

  const map = new Map({
    basemap:"streets-navigation-vector"
  });

  const view = new MapView({
    container:"viewDiv",
    map:map,
    center:[-54,-14],
    zoom:4
  });

  const bairrosLayer = new FeatureLayer({
    url:BAIRROS_URL,
    outFields:["*"],
    definitionExpression:`cod_loja_zinflu = '${codLoja}'`,
    visible:true
  });

  const zonasLayer = new FeatureLayer({
    url:ZONAS_URL,
    outFields:["*"],
    definitionExpression:`COD_LOJA = '${codLoja}'`,
    visible:true
  });

  const lojasLayer = new FeatureLayer({
    url:LOJAS_URL,
    outFields:["*"],
    definitionExpression:`cod_loja = '${codLoja}'`,
    visible:true
  });

  map.add(bairrosLayer);
  map.add(zonasLayer);
  map.add(lojasLayer);

  //-----------------------------------
  // ðŸ”¥ SE LOJA = 0 â†’ MOSTRAR BRASIL
  //-----------------------------------
  if(codLoja == "0"){
    bairrosLayer.visible = false;
    zonasLayer.visible = false;
    lojasLayer.visible = true;

    view.goTo({
      center:[-54,-14],
      zoom:4
    });

    return;
  }

  //-----------------------------------
  // resto do seu processamento normal
  //-----------------------------------

});
</script>
</body>
</html>
